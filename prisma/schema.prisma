generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id            String        @id @default(cuid())
  email         String        @unique
  name          String?
  password      String
  clerkId       String?       @unique
  phone         String?       @unique
  phoneVerified Boolean       @default(false)
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  chatMessages  ChatMessage[]
  chatSessions  ChatSession[]
  documents     Document[]

  @@map("users")
}

model Document {
  id             String        @id @default(cuid())
  originalName   String
  filename       String
  size           Int
  mimeType       String
  path           String
  processed      Boolean       @default(false)
  classification String?
  summary        String?
  uploadedAt     DateTime      @default(now())
  userId         String
  chatMessages   ChatMessage[]
  chatSessions   ChatSession[]
  user           User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("documents")
}

model ChatSession {
  id         String        @id @default(cuid())
  title      String?
  createdAt  DateTime      @default(now())
  updatedAt  DateTime      @updatedAt
  userId     String
  documentId String?
  messages   ChatMessage[]
  document   Document?     @relation(fields: [documentId], references: [id])
  user       User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("chat_sessions")
}

model ChatMessage {
  id         String      @id @default(cuid())
  message    String
  response   String
  mode       String      @default("qna")
  sources    String?
  timestamp  DateTime    @default(now())
  userId     String
  documentId String?
  sessionId  String
  session    ChatSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  document   Document?   @relation(fields: [documentId], references: [id])
  user       User        @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("chat_messages")
}
